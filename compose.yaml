services:
  raise-mongo: # MongoDB service
    container_name: raise-mongo
    image: mongo
    networks:
      - raise-net
    ports:
      - "27017:27017"
    restart: unless-stopped

  raise-postgres: # PostgreSQL service
    container_name: raise-postgres
    image: postgres
    networks:
      - raise-net
    ports:
      - "5432:5432"
    environment:
      - POSTGRES_USER=account
      - POSTGRES_PASSWORD=yourpassword
      - POSTGRES_DB=raise_db

  raise-pgadmin: # pgAdmin service
    depends_on:
      - raise-postgres
    container_name: raise-pgadmin
    image: dpage/pgadmin4
    networks:
      - raise-net
    ports:
      - "5050:80"
    environment:
      PGADMIN_DEFAULT_EMAIL: admin@local.it
      PGADMIN_DEFAULT_PASSWORD: admin
    restart: unless-stopped

  raise-mqtt: # MQTT broker service
    container_name: raise-mqtt
    image: eclipse-mosquitto
    networks:
      - raise-net
    ports:
      - "1883:1883"
    volumes:
      - ./mosquitto.conf:/mosquitto/config/mosquitto.conf
    restart: unless-stopped

  raise-cdt: # CoCo service
    depends_on:
      - raise-mongo
      - raise-postgres
      - raise-mqtt
    container_name: raise-cdt
    image: raise-cdt
    networks:
      - raise-net
    ports:
      - "8080:8080"
    restart: unless-stopped
    build:
      context: .
      args:
        - MONGODB_HOST=raise-mongo
        - POSTGRES_USER=account
        - POSTGRES_PASSWORD=yourpassword
        - POSTGRES_HOST=raise-postgres
        - MQTT_HOST=raise-mqtt
    environment:
      - FCM_CLIENT_EMAIL=${FCM_CLIENT_EMAIL}
      - FCM_PRIVATE_KEY=${FCM_PRIVATE_KEY}

networks:
  raise-net: